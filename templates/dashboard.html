{% extends "base.html" %}
{% block title %}{% if team %}{{ team.name }} Players{% else %}Player Directory{% endif %} ‚Äî Bearcats Recruiting{% endblock %}
{% block content %}
<div class="container page-top">
    <div class="page-header">
        <div>
            {% if team %}
            <a href="/dashboard" class="back-link">‚Üê All Teams</a>
            <h1>{{ team.name }}</h1>
            <p class="page-sub">{{ player_data|length }} player{{ 's' if player_data|length != 1 else '' }} registered</p>
            {% else %}
            <h1>Player Directory</h1>
            <p class="page-sub">Browse all registered players</p>
            {% endif %}
        </div>
        {% if user %}
        <div class="header-actions">
            <a href="/profile/{{ user.username }}" class="btn btn-outline">My Profile</a>
            {% if user.role == "player" %}
            <a href="/profile/edit" class="btn btn-primary">Edit Profile</a>
            {% endif %}
        </div>
        {% endif %}
    </div>

    {% if user and teams %}
    <div class="team-filter-bar">
        <span class="filter-label">Filter:</span>
        <a href="/dashboard" class="team-pill {% if not active_team_id %}active{% endif %}">All Teams</a>
        {% for t in teams %}
        <a href="/dashboard?team_id={{ t.id }}" class="team-pill {% if active_team_id == t.id %}active{% endif %}">{{ t.name }}</a>
        {% endfor %}
    </div>
    {% endif %}

    {% if player_data %}
    <div class="player-grid">
        {% for item in player_data %}
        {% set p = item.profile %}
        <a href="/profile/{{ item.user.username }}" class="player-card" style="position:relative; text-align:center;">
            <!-- Avatar centered -->
            <div style="display:flex; justify-content:center; margin-bottom:12px;">
                <div class="player-avatar" style="width:64px; height:64px; font-size:26px;">
                    {% if p and p.photo %}
                        <img src="{{ p.photo }}" alt="Profile photo" class="avatar-img">
                    {% else %}
                        {{ (p.first_name[0] if p and p.first_name else item.user.username[0]) | upper }}
                    {% endif %}
                </div>
            </div>
            <!-- Name and position below avatar -->
            <div style="margin-bottom:10px;">
                <h3 style="font-size:17px; font-weight:700; color:#0a1628; margin-bottom:5px;">
                    {% if p and (p.first_name or p.last_name) %}
                        {{ p.first_name }} {{ p.last_name }}
                    {% else %}
                        {{ item.user.username }}
                    {% endif %}
                </h3>
                <span class="position-badge">{{ p.position if p and p.position else "Position TBD" }}</span>
            </div>
            <!-- Stats -->
            <div class="player-stats-preview" style="justify-content:center;">
                {% if p and p.height %}<span class="stat-pill"><strong>HT</strong> {{ p.height }}</span>{% endif %}
                {% if p and p.weight %}<span class="stat-pill"><strong>WT</strong> {{ p.weight }} lbs</span>{% endif %}
                {% if p and p.year %}<span class="stat-pill"><strong>Class of</strong> {{ p.year }}</span>{% endif %}
            </div>
            {% if p and p.school %}
            <div class="player-location" style="text-align:center;">üè´ {{ p.school }}</div>
            {% endif %}
            {% if p and (p.hudl_url or p.x_url or p.instagram_url) %}
            <div style="position:absolute; top:14px; right:14px; display:flex; flex-direction:column; gap:8px; align-items:center;">
                {% if p.hudl_url %}
                <div title="Hudl Highlights"
                     onclick="event.preventDefault(); event.stopPropagation(); window.open('{{ p.hudl_url }}', '_blank');"
                     style="width:44px; height:44px; border-radius:50%; overflow:hidden; cursor:pointer;
                            box-shadow:0 2px 8px rgba(249,107,43,0.4); transition:transform 0.15s, box-shadow 0.15s; flex-shrink:0;"
                     onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 14px rgba(249,107,43,0.55)';"
                     onmouseout="this.style.transform=''; this.style.boxShadow='0 2px 8px rgba(249,107,43,0.4)';">
                    <img src="/static/hudl.png" style="width:44px; height:44px; object-fit:cover; display:block;" alt="Hudl">
                </div>
                {% endif %}
                {% if p.x_url %}
                <div title="X (Twitter)"
                     onclick="event.preventDefault(); event.stopPropagation(); window.open('{{ p.x_url }}', '_blank');"
                     style="width:44px; height:44px; border-radius:50%; overflow:hidden; cursor:pointer;
                            box-shadow:0 2px 8px rgba(0,0,0,0.25); transition:transform 0.15s, box-shadow 0.15s; flex-shrink:0;"
                     onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 14px rgba(0,0,0,0.35)';"
                     onmouseout="this.style.transform=''; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.25)';">
                    <img src="/static/x_logo.svg" style="width:44px; height:44px; object-fit:cover; display:block;" alt="X">
                </div>
                {% endif %}
                {% if p.instagram_url %}
                <div title="Instagram"
                     onclick="event.preventDefault(); event.stopPropagation(); window.open('{{ p.instagram_url }}', '_blank');"
                     style="width:44px; height:44px; border-radius:50%; overflow:hidden; cursor:pointer;
                            box-shadow:0 2px 8px rgba(214,41,118,0.35); transition:transform 0.15s, box-shadow 0.15s; flex-shrink:0;"
                     onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 14px rgba(214,41,118,0.5)';"
                     onmouseout="this.style.transform=''; this.style.boxShadow='0 2px 8px rgba(214,41,118,0.35)';">
                    <img src="/static/instagram_logo.svg" style="width:44px; height:44px; object-fit:cover; display:block;" alt="Instagram">
                </div>
                {% endif %}
            </div>
            {% endif %}
        </a>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">üèà</div>
        <h3>No players yet</h3>
        <p>{% if team %}No players have joined {{ team.name }} yet.{% else %}Players who sign up will appear here.{% endif %}</p>
    </div>
    {% endif %}
</div>
{% endblock %}
